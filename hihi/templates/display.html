<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Ch√∫c M·ª´ng Sinh Nh·∫≠t - {{ event.name }}</title>
    <style>
      /* Thi·∫øt k·∫ø giao di·ªán tr√¨nh chi·∫øu */
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #2c3e50; /* M√†u n·ªÅn t·ªëi */
        color: white;
        text-align: center;
        margin: 0;
        padding: 0;
      }
      #header {
        padding: 20px;
        background: #e74c3c; /* M√†u ƒë·ªè n·ªïi b·∫≠t */
      }
      h1 {
        margin: 0;
        font-size: 2.5em;
      }
      #wishes-container {
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
      }
      .wish-card {
        background: #34495e; /* M√†u card t·ªëi */
        border-radius: 15px;
        margin: 15px;
        padding: 20px;
        width: 300px;
        text-align: left;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        /* animation nh·∫π cho l·ªùi ch√∫c m·ªõi */
        opacity: 1;
        transition: opacity 0.5s ease-in-out;
      }
      .wish-card h4 {
        color: #f1c40f;
        margin-top: 0;
        font-size: 1.2em;
        border-bottom: 1px solid #4a637a;
        padding-bottom: 5px;
      }
      .wish-card p {
        font-size: 1.1em;
        line-height: 1.4;
        white-space: pre-wrap;
      }
      .wish-card small {
        display: block;
        text-align: right;
        margin-top: 10px;
        color: #bdc3c7;
        font-style: italic;
      }
      .total-count {
        font-size: 1.5em;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div id="header">
      <h1>üéâ Ch√∫c M·ª´ng {{ event.name }}! üéâ</h1>
      <div class="total-count">
        T·ªïng s·ªë l·ªùi ch√∫c: <span id="wish-count">0</span>
      </div>
    </div>

    <div id="wishes-container"></div>

    <script>
      const slug = "{{ event.slug }}";
      const container = document.getElementById("wishes-container");
      const countDisplay = document.getElementById("wish-count");

      // H√†m l·∫•y d·ªØ li·ªáu v√† c·∫≠p nh·∫≠t giao di·ªán
      function fetchWishes() {
        fetch(`/api/${slug}/wishes`)
          .then((response) => response.json())
          .then((data) => {
            countDisplay.textContent = data.total;
            renderWishes(data.wishes);
          })
          .catch((error) => console.error("L·ªói khi l·∫•y l·ªùi ch√∫c:", error));
      }

      // H√†m render HTML t·ª´ d·ªØ li·ªáu JSON
      function renderWishes(wishes) {
        // L·∫•y ID c·ªßa c√°c l·ªùi ch√∫c HI·ªÜN T·∫†I tr√™n m√†n h√¨nh
        const existingIds = new Set(
          Array.from(container.children).map((card) => card.dataset.wishId)
        );

        wishes.forEach((wish) => {
          // Ch·ªâ th√™m l·ªùi ch√∫c n·∫øu ID ch∆∞a t·ªìn t·∫°i
          if (!existingIds.has(String(wish.id))) {
            const card = document.createElement("div");
            card.className = "wish-card";
            card.dataset.wishId = wish.id;

            card.innerHTML = `
                        <h4>T·ª´: ${wish.sender}</h4>
                        <p>${wish.message}</p>
                        <small>G·ª≠i l√∫c: ${wish.when}</small>
                    `;

            // Th√™m l·ªùi ch√∫c m·ªõi l√™n ƒë·∫ßu ƒë·ªÉ d·ªÖ th·∫•y
            container.prepend(card);
          }
        });

        // Gi·ªõi h·∫°n s·ªë l∆∞·ª£ng th·∫ª hi·ªÉn th·ªã (v√≠ d·ª• 30 th·∫ª) ƒë·ªÉ tr√°nh qu√° t·∫£i
        while (container.children.length > 30) {
          container.removeChild(container.lastChild);
        }
      }

      // 1. Ch·∫°y l·∫ßn ƒë·∫ßu ngay khi t·∫£i trang
      fetchWishes();

      // 2. Thi·∫øt l·∫≠p ch·∫°y t·ª± ƒë·ªông m·ªói 5 gi√¢y
      setInterval(fetchWishes, 5000);
    </script>
  </body>
</html>
